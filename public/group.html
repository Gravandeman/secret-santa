<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>–ì—Ä—É–ø–ø–∞ - –¢–∞–π–Ω—ã–π –°–∞–Ω—Ç–∞</title>
    <link rel="stylesheet" href="style.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <style>
        .group-actions {
            display: flex;
            flex-wrap: wrap;
            gap: 12px;
            margin: 24px 0;
        }
        
        .info-card {
            background: white;
            border-radius: 12px;
            padding: 20px;
            margin-bottom: 24px;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
        }
        
        .info-row {
            display: flex;
            justify-content: space-between;
            padding: 12px 0;
            border-bottom: 1px solid #E9ECEF;
        }
        
        .info-row:last-child {
            border-bottom: none;
        }
        
        .wishlist-preview {
            background: #F7FFF7;
            border-radius: 8px;
            padding: 12px;
            margin-top: 8px;
        }
        
        .wishlist-preview ul {
            margin: 0;
            padding-left: 20px;
        }
        
        .receiver-card {
            background: linear-gradient(135deg, #4ECDC4 0%, #44A08D 100%);
            color: white;
            border-radius: 12px;
            padding: 32px;
            margin: 24px 0;
            text-align: center;
        }
    </style>
</head>
<body>
    <!-- –ù–∞–≤–∏–≥–∞—Ü–∏—è -->
    <nav class="navbar">
        <div class="navbar-container">
            <a href="/" class="navbar-brand">
                <i class="fas fa-gift"></i>
                –¢–∞–π–Ω—ã–π –°–∞–Ω—Ç–∞
            </a>
            <div class="navbar-menu">
                <a href="dashboard.html" class="nav-link">
                    <i class="fas fa-home"></i> –ú–æ–∏ –≥—Ä—É–ø–ø—ã
                </a>
                <a href="create-group.html" class="nav-link">
                    <i class="fas fa-plus"></i> –°–æ–∑–¥–∞—Ç—å –≥—Ä—É–ø–ø—É
                </a>
                <a href="join-group.html" class="nav-link">
                    <i class="fas fa-user-plus"></i> –ü—Ä–∏—Å–æ–µ–¥–∏–Ω–∏—Ç—å—Å—è
                </a>
                <button onclick="API.logout()" class="btn btn-secondary btn-small">
                    <i class="fas fa-sign-out-alt"></i> –í—ã–π—Ç–∏
                </button>
            </div>
            <button class="mobile-menu-btn">
                <i class="fas fa-bars"></i>
            </button>
        </div>
    </nav>

    <!-- –û—Å–Ω–æ–≤–Ω–æ–π –∫–æ–Ω—Ç–µ–Ω—Ç -->
    <div class="container dashboard">
        <div class="section-title">
            <h1 id="groupName">–ó–∞–≥—Ä—É–∑–∫–∞...</h1>
            <div style="display: flex; gap: 12px;">
                <a href="dashboard.html" class="btn btn-secondary">
                    <i class="fas fa-arrow-left"></i> –ù–∞–∑–∞–¥
                </a>
                <button onclick="copyInviteLink()" class="btn btn-primary">
                    <i class="fas fa-share"></i> –ü—Ä–∏–≥–ª–∞—Å–∏—Ç—å
                </button>
            </div>
        </div>
        
        <!-- –ò–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è –æ –≥—Ä—É–ø–ø–µ -->
        <div id="groupInfo" class="info-card" style="display: none;">
            <div class="info-row">
                <span style="color: #6C757D;">–ö–æ–¥ –≥—Ä—É–ø–ø—ã:</span>
                <span id="groupCode" style="font-family: monospace; font-weight: 600;"></span>
            </div>
            <div class="info-row">
                <span style="color: #6C757D;">–°—Ç–∞—Ç—É—Å:</span>
                <span id="groupStatus"></span>
            </div>
            <div class="info-row">
                <span style="color: #6C757D;">–û—Ä–≥–∞–Ω–∏–∑–∞—Ç–æ—Ä:</span>
                <span id="groupAdmin"></span>
            </div>
            <div class="info-row">
                <span style="color: #6C757D;">–£—á–∞—Å—Ç–Ω–∏–∫–∏:</span>
                <span id="groupParticipants"></span>
            </div>
            <div class="info-row">
                <span style="color: #6C757D;">–î–∞—Ç–∞ —Å–æ–∑–¥–∞–Ω–∏—è:</span>
                <span id="groupCreated"></span>
            </div>
        </div>
        
        <!-- –î–µ–π—Å—Ç–≤–∏—è -->
        <div id="groupActions" class="group-actions" style="display: none;">
            <a href="#" id="wishlistLink" class="btn btn-primary">
                <i class="fas fa-list-check"></i> –ú–æ–π —Å–ø–∏—Å–æ–∫ –∂–µ–ª–∞–Ω–∏–π
            </a>
            <button onclick="viewReceiver()" id="viewReceiverBtn" class="btn btn-secondary" style="display: none;">
                <i class="fas fa-gift"></i> –ú–æ–π –ø–æ–ª—É—á–∞—Ç–µ–ª—å
            </button>
            <button onclick="startDraw()" id="startDrawBtn" class="btn btn-secondary" style="display: none;">
                <i class="fas fa-random"></i> –ü—Ä–æ–≤–µ—Å—Ç–∏ –∂–µ—Ä–µ–±—å–µ–≤–∫—É
            </button>
            <button onclick="viewAllAssignments()" id="viewAllAssignmentsBtn" class="btn btn-secondary" style="display: none;">
                <i class="fas fa-eye"></i> –í—Å–µ –Ω–∞–∑–Ω–∞—á–µ–Ω–∏—è
            </button>
        </div>

        <!-- –ü–æ–ª—É—á–∞—Ç–µ–ª—å -->
        <div id="receiverSection" class="receiver-card" style="display: none;">
            <h2 style="margin-bottom: 16px;">üéÅ –í–∞—à –ø–æ–ª—É—á–∞—Ç–µ–ª—å</h2>
            <h3 id="receiverName" style="margin-bottom: 24px;"></h3>
            
            <div id="receiverWishlist" style="text-align: left; margin-top: 24px;">
                <h4 style="margin-bottom: 12px;">
                    <i class="fas fa-list-check"></i> –°–ø–∏—Å–æ–∫ –∂–µ–ª–∞–Ω–∏–π:
                </h4>
                <div id="wishlistItems"></div>
            </div>
            
            <p style="margin-top: 24px; opacity: 0.9; font-style: italic;">
                <i class="fas fa-shield-alt"></i> –≠—Ç–æ —Å–µ–∫—Ä–µ—Ç–Ω–∞—è –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è! –ù–µ –≥–æ–≤–æ—Ä–∏—Ç–µ –Ω–∏–∫–æ–º—É!
            </p>
        </div>
        
        <!-- –ü–æ–ª—É—á–∞—Ç–µ–ª—å -->
        <div id="receiverSection" class="receiver-card" style="display: none;">
            <h2 style="margin-bottom: 16px;">üéÅ –í–∞—à –ø–æ–ª—É—á–∞—Ç–µ–ª—å</h2>
            <h3 id="receiverName" style="margin-bottom: 24px;"></h3>
            
            <div id="receiverWishlist" style="text-align: left; margin-top: 24px;">
                <h4 style="margin-bottom: 12px;">–°–ø–∏—Å–æ–∫ –∂–µ–ª–∞–Ω–∏–π:</h4>
                <div id="wishlistItems"></div>
            </div>
            
            <p style="margin-top: 24px; opacity: 0.9; font-style: italic;">
                –≠—Ç–æ —Å–µ–∫—Ä–µ—Ç–Ω–∞—è –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è! –ù–µ –≥–æ–≤–æ—Ä–∏—Ç–µ –Ω–∏–∫–æ–º—É!
            </p>
        </div>
        
        <!-- –£—á–∞—Å—Ç–Ω–∏–∫–∏ -->
        <div class="card">
            <h2 style="margin-bottom: 24px;">–£—á–∞—Å—Ç–Ω–∏–∫–∏ –≥—Ä—É–ø–ø—ã</h2>
            <div id="participantsList">
                <!-- –£—á–∞—Å—Ç–Ω–∏–∫–∏ –±—É–¥—É—Ç –∑–∞–≥—Ä—É–∂–µ–Ω—ã –∑–¥–µ—Å—å -->
            </div>
        </div>
        
        <!-- –ü—Ä–∏–≥–ª–∞—à–µ–Ω–∏–µ -->
        <div id="inviteModal" class="modal" style="display: none;">
            <div class="modal-content" style="max-width: 500px;">
                <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 24px;">
                    <h2 style="margin: 0;">–ü—Ä–∏–≥–ª–∞—Å–∏—Ç—å –≤ –≥—Ä—É–ø–ø—É</h2>
                    <button onclick="closeInviteModal()" style="background: none; border: none; font-size: 24px; cursor: pointer; color: #6C757D;">
                        √ó
                    </button>
                </div>
                
                <div class="form-group">
                    <label>–°—Å—ã–ª–∫–∞ –¥–ª—è –ø—Ä–∏–≥–ª–∞—à–µ–Ω–∏—è:</label>
                    <div style="display: flex; gap: 8px;">
                        <input type="text" id="inviteLink" class="form-control" readonly>
                        <button onclick="copyLink()" class="btn btn-primary">
                            <i class="fas fa-copy"></i>
                        </button>
                    </div>
                </div>
                
                <div class="form-group">
                    <label>–ö–æ–¥ –≥—Ä—É–ø–ø—ã:</label>
                    <div style="display: flex; gap: 8px;">
                        <input type="text" id="inviteCode" class="form-control" readonly 
                               style="font-family: monospace; font-weight: 600; text-transform: uppercase;">
                        <button onclick="copyCode()" class="btn btn-primary">
                            <i class="fas fa-copy"></i>
                        </button>
                    </div>
                </div>
                
                <div style="margin-top: 24px; padding: 16px; background: #F7FFF7; border-radius: 8px;">
                    <p style="margin: 0; color: #6C757D;">
                        <i class="fas fa-info-circle"></i> –û—Ç–ø—Ä–∞–≤—å—Ç–µ —ç—Ç—É –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—é –¥—Ä—É–∑—å—è–º, —á—Ç–æ–±—ã –æ–Ω–∏ –º–æ–≥–ª–∏ –ø—Ä–∏—Å–æ–µ–¥–∏–Ω–∏—Ç—å—Å—è
                    </p>
                </div>
            </div>
        </div>
    </div>

    <script src="script.js"></script>
    <script>
        let currentGroup = null;
        let currentGroupId = null;
        
        // –ó–∞–≥—Ä—É–∑–∫–∞ –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏–∏ –æ –≥—Ä—É–ø–ø–µ
        async function loadGroup() {
            const urlParams = new URLSearchParams(window.location.search);
            currentGroupId = urlParams.get('id');
            
            if (!currentGroupId) {
                window.location.href = 'dashboard.html';
                return;
            }
            
            try {
                const result = await API.getGroup(currentGroupId);
                currentGroup = result.group;
                displayGroupInfo();
                displayParticipants();
                updateActions();
                
                // –ï—Å–ª–∏ –µ—Å—Ç—å –ø–æ–ª—É—á–∞—Ç–µ–ª—å, –ø–æ–∫–∞–∑—ã–≤–∞–µ–º –µ–≥–æ
                if (currentGroup.myReceiver) {
                    displayReceiver(currentGroup.myReceiver);
                }
            } catch (error) {
                Utils.showNotification('–û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ –≥—Ä—É–ø–ø—ã', 'error');
                setTimeout(() => {
                    window.location.href = 'dashboard.html';
                }, 2000);
            }
        }
        
        // –û—Ç–æ–±—Ä–∞–∂–µ–Ω–∏–µ –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏–∏ –æ –≥—Ä—É–ø–ø–µ
        function displayGroupInfo() {
            document.getElementById('groupName').textContent = currentGroup.name;
            document.getElementById('groupCode').textContent = currentGroup.code;
            document.getElementById('groupAdmin').textContent = currentGroup.participants.find(p => p.isAdmin)?.name || '–û—Ä–≥–∞–Ω–∏–∑–∞—Ç–æ—Ä';
            document.getElementById('groupParticipants').textContent = `${currentGroup.participantsCount}/${currentGroup.maxParticipants}`;
            document.getElementById('groupCreated').textContent = Utils.formatDate(currentGroup.createdAt);
            
            let statusText = '–ê–∫—Ç–∏–≤–Ω–∞';
            let statusColor = '#4ECDC4';
            let statusIcon = 'üü¢';
            if (currentGroup.status === 'completed') {
                statusText = '–ñ–µ—Ä–µ–±—å–µ–≤–∫–∞ –ø—Ä–æ–≤–µ–¥–µ–Ω–∞';
                statusColor = '#FF6B6B';
                statusIcon = 'üéÅ';
            }
            
            document.getElementById('groupStatus').innerHTML = `
                <span style="background: ${statusColor}; color: white; padding: 4px 12px; border-radius: 20px; font-size: 14px;">
                    ${statusIcon} ${statusText}
                </span>
            `;
            
            document.getElementById('groupInfo').style.display = 'block';
        }
        
        // –û—Ç–æ–±—Ä–∞–∂–µ–Ω–∏–µ —É—á–∞—Å—Ç–Ω–∏–∫–æ–≤
        function displayParticipants() {
            const container = document.getElementById('participantsList');
            container.innerHTML = '';
            
            if (currentGroup.participants.length === 0) {
                container.innerHTML = `
                    <div style="text-align: center; padding: 40px; color: #6C757D;">
                        <i class="fas fa-users" style="font-size: 48px; color: #E9ECEF; margin-bottom: 16px;"></i>
                        <p>–í –≥—Ä—É–ø–ø–µ –ø–æ–∫–∞ –Ω–µ—Ç —É—á–∞—Å—Ç–Ω–∏–∫–æ–≤</p>
                    </div>
                `;
                return;
            }
            
            currentGroup.participants.forEach(participant => {
                const row = document.createElement('div');
                row.className = 'participant-row';
                
                row.innerHTML = `
                    <div class="participant-info">
                        <div class="participant-avatar" style="background: ${participant.isAdmin ? '#4ECDC4' : '#FF6B6B'}">
                            ${Utils.getAvatar(participant.name)}
                        </div>
                        <div>
                            <div style="font-weight: 600;">${participant.name}</div>
                            <div style="color: #6C757D; font-size: 14px;">
                                ${participant.isAdmin ? '–û—Ä–≥–∞–Ω–∏–∑–∞—Ç–æ—Ä' : '–£—á–∞—Å—Ç–Ω–∏–∫'}
                            </div>
                        </div>
                    </div>
                    <div style="display: flex; align-items: center; gap: 12px;">
                        ${participant.hasWishlist ? 
                            `<span style="color: #4ECDC4;" title="–°–ø–∏—Å–æ–∫ –∂–µ–ª–∞–Ω–∏–π">
                                <i class="fas fa-list-check"></i> ${participant.wishlistCount} –∂–µ–ª–∞–Ω–∏–π
                            </span>` : 
                            '<span style="color: #6C757D; font-size: 14px;">–ù–µ—Ç —Å–ø–∏—Å–∫–∞</span>'
                        }
                        ${participant.userId === JSON.parse(localStorage.getItem('user')).id ? 
                            '<span style="color: #6C757D; font-size: 14px;">(–≠—Ç–æ –≤—ã)</span>' : ''
                        }
                    </div>
                `;
                
                container.appendChild(row);
            });
        }
        
        // –û—Ç–æ–±—Ä–∞–∂–µ–Ω–∏–µ –ø–æ–ª—É—á–∞—Ç–µ–ª—è
        function displayReceiver(receiver) {
            const receiverSection = document.getElementById('receiverSection');
            const receiverName = document.getElementById('receiverName');
            const wishlistItems = document.getElementById('wishlistItems');
            
            receiverName.textContent = receiver.name;
            
            if (receiver.wishlist && receiver.wishlist.length > 0) {
                const list = document.createElement('ul');
                list.style.listStyle = 'none';
                list.style.padding = '0';
                list.style.margin = '0';
                
                receiver.wishlist.forEach(item => {
                    const li = document.createElement('li');
                    li.textContent = `üéØ ${item}`;
                    li.style.padding = '8px 0';
                    li.style.borderBottom = '1px solid rgba(255,255,255,0.1)';
                    list.appendChild(li);
                });
                wishlistItems.innerHTML = '';
                wishlistItems.appendChild(list);
            } else {
                wishlistItems.innerHTML = `
                    <div style="text-align: center; padding: 20px;">
                        <i class="fas fa-info-circle" style="font-size: 24px; margin-bottom: 12px;"></i>
                        <p style="opacity: 0.9;">–£ –ø–æ–ª—É—á–∞—Ç–µ–ª—è –ø–æ–∫–∞ –Ω–µ—Ç —Å–ø–∏—Å–∫–∞ –∂–µ–ª–∞–Ω–∏–π</p>
                        <p style="opacity: 0.7; font-size: 14px;">–ü—Ä–∏–¥—É–º–∞–π—Ç–µ –ø–æ–¥–∞—Ä–æ–∫ —Å–∞–º–æ—Å—Ç–æ—è—Ç–µ–ª—å–Ω–æ!</p>
                    </div>
                `;
            }
            
            receiverSection.style.display = 'block';
        }

        // –ü—Ä–æ—Å–º–æ—Ç—Ä –≤—Å–µ—Ö –Ω–∞–∑–Ω–∞—á–µ–Ω–∏–π (–¥–ª—è –∞–¥–º–∏–Ω–∞)
        async function viewAllAssignments() {
            try {
                const result = await API.getAllAssignments(currentGroupId);
                
                let message = 'üéÅ –í—Å–µ –Ω–∞–∑–Ω–∞—á–µ–Ω–∏—è –≤ –≥—Ä—É–ø–ø–µ:\n\n';
                
                for (const [giver, receiver] of Object.entries(result.assignments)) {
                    message += `üéÖ ${giver} –¥–∞—Ä–∏—Ç –ø–æ–¥–∞—Ä–æ–∫ ${receiver.name}\n`;
                    
                    if (receiver.wishlist && receiver.wishlist.length > 0) {
                        message += `  üéØ –ñ–µ–ª–∞–Ω–∏—è: ${receiver.wishlist.join(', ')}\n`;
                    }
                    message += '\n';
                }
                
                alert(message);
            } catch (error) {
                Utils.showNotification('–¢–æ–ª—å–∫–æ –æ—Ä–≥–∞–Ω–∏–∑–∞—Ç–æ—Ä –º–æ–∂–µ—Ç –ø—Ä–æ—Å–º–∞—Ç—Ä–∏–≤–∞—Ç—å –≤—Å–µ –Ω–∞–∑–Ω–∞—á–µ–Ω–∏—è', 'error');
            }
        }
        
        // –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ –¥–æ—Å—Ç—É–ø–Ω—ã—Ö –¥–µ–π—Å—Ç–≤–∏–π
        function updateActions() {
            const isAdmin = currentGroup.isAdmin;
            const isActive = currentGroup.status === 'active';
            
            // –°—Å—ã–ª–∫–∞ –Ω–∞ —Å–ø–∏—Å–æ–∫ –∂–µ–ª–∞–Ω–∏–π
            const wishlistLink = document.getElementById('wishlistLink');
            wishlistLink.href = `wishlist.html?groupId=${currentGroupId}`;
            
            // –ö–Ω–æ–ø–∫–∞ "–ú–æ–π –ø–æ–ª—É—á–∞—Ç–µ–ª—å"
            const viewReceiverBtn = document.getElementById('viewReceiverBtn');
            if (currentGroup.myReceiver) {
                viewReceiverBtn.style.display = 'inline-flex';
            }
            
            // –ö–Ω–æ–ø–∫–∞ "–ü—Ä–æ–≤–µ—Å—Ç–∏ –∂–µ—Ä–µ–±—å–µ–≤–∫—É"
            const startDrawBtn = document.getElementById('startDrawBtn');
            if (isAdmin && isActive && currentGroup.participantsCount >= 2) {
                startDrawBtn.style.display = 'inline-flex';
            }
            
            // –ö–Ω–æ–ø–∫–∞ "–ü–æ–∫–∞–∑–∞—Ç—å –≤—Å–µ –Ω–∞–∑–Ω–∞—á–µ–Ω–∏—è" (—Ç–æ–ª—å–∫–æ –¥–ª—è –∞–¥–º–∏–Ω–∞)
            const viewAllAssignmentsBtn = document.getElementById('viewAllAssignmentsBtn');
            if (isAdmin && currentGroup.status === 'completed') {
                viewAllAssignmentsBtn.style.display = 'inline-flex';
            }
            
            document.getElementById('groupActions').style.display = 'flex';
        }
        
        // –ü—Ä–æ–≤–µ–¥–µ–Ω–∏–µ –∂–µ—Ä–µ–±—å–µ–≤–∫–∏
        async function startDraw() {
            if (!confirm('–ü—Ä–æ–≤–µ—Å—Ç–∏ –∂–µ—Ä–µ–±—å–µ–≤–∫—É?\n\n–ü–æ—Å–ª–µ —ç—Ç–æ–≥–æ –Ω–æ–≤—ã–µ —É—á–∞—Å—Ç–Ω–∏–∫–∏ –Ω–µ —Å–º–æ–≥—É—Ç –ø—Ä–∏—Å–æ–µ–¥–∏–Ω–∏—Ç—å—Å—è, –∞ –≤—Å–µ —É—á–∞—Å—Ç–Ω–∏–∫–∏ —É–≤–∏–¥—è—Ç, –∫–æ–º—É –æ–Ω–∏ –¥–∞—Ä—è—Ç –ø–æ–¥–∞—Ä–∫–∏.')) {
                return;
            }
            
            try {
                const result = await API.drawGroup(currentGroupId);
                
                if (result.success) {
                    // –ü–æ–∫–∞–∑—ã–≤–∞–µ–º —Ä–µ–∑—É–ª—å—Ç–∞—Ç—ã –¥–ª—è –æ—Ä–≥–∞–Ω–∏–∑–∞—Ç–æ—Ä–∞
                    let resultsMessage = '–ñ–µ—Ä–µ–±—å–µ–≤–∫–∞ –ø—Ä–æ–≤–µ–¥–µ–Ω–∞ —É—Å–ø–µ—à–Ω–æ!\n\n–†–µ–∑—É–ª—å—Ç–∞—Ç—ã:\n\n';
                    
                    for (const [giver, receiver] of Object.entries(result.results)) {
                        resultsMessage += `${giver} ‚Üí ${receiver}\n`;
                    }
                    
                    resultsMessage += '\n–í—Å–µ —É—á–∞—Å—Ç–Ω–∏–∫–∏ —Ç–µ–ø–µ—Ä—å –≤–∏–¥—è—Ç —Å–≤–æ–∏—Ö –ø–æ–ª—É—á–∞—Ç–µ–ª–µ–π.';
                    
                    alert(resultsMessage);
                    
                    // –ü–µ—Ä–µ–∑–∞–≥—Ä—É–∂–∞–µ–º —Å—Ç—Ä–∞–Ω–∏—Ü—É
                    loadGroup();
                }
            } catch (error) {
                Utils.showNotification(error.message, 'error');
            }
        }
        
        // –ü—Ä–æ—Å–º–æ—Ç—Ä –ø–æ–ª—É—á–∞—Ç–µ–ª—è
        function viewReceiver() {
            const receiverSection = document.getElementById('receiverSection');
            if (receiverSection.style.display === 'none') {
                loadReceiver();
            } else {
                receiverSection.scrollIntoView({ behavior: 'smooth' });
            }
        }
        
        // –ó–∞–≥—Ä—É–∑–∫–∞ –ø–æ–ª—É—á–∞—Ç–µ–ª—è –æ—Ç–¥–µ–ª—å–Ω–æ (–Ω–∞ —Å–ª—É—á–∞–π, –µ—Å–ª–∏ –Ω–µ –∑–∞–≥—Ä—É–∑–∏–ª—Å—è –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏)
        async function loadReceiver() {
            try {
                const result = await API.getReceiver(currentGroupId);
                displayReceiver(result.receiver);
                receiverSection.scrollIntoView({ behavior: 'smooth' });
            } catch (error) {
                Utils.showNotification('–ù–µ —É–¥–∞–ª–æ—Å—å –∑–∞–≥—Ä—É–∑–∏—Ç—å –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—é –æ –ø–æ–ª—É—á–∞—Ç–µ–ª–µ', 'error');
            }
        }
        
        // –ü—Ä–æ—Å–º–æ—Ç—Ä –≤—Å–µ—Ö –Ω–∞–∑–Ω–∞—á–µ–Ω–∏–π (–¥–ª—è –∞–¥–º–∏–Ω–∞)
        async function viewAllAssignments() {
            try {
                const result = await API.get(`${API.baseUrl}/api/groups/${currentGroupId}/assignments`);
                
                let message = 'üéÅ –í—Å–µ –Ω–∞–∑–Ω–∞—á–µ–Ω–∏—è –≤ –≥—Ä—É–ø–ø–µ:\n\n';
                
                for (const [giver, receiver] of Object.entries(result.assignments)) {
                    message += `${giver} –¥–∞—Ä–∏—Ç –ø–æ–¥–∞—Ä–æ–∫ ${receiver.name}\n`;
                    
                    if (receiver.wishlist && receiver.wishlist.length > 0) {
                        message += `  –ñ–µ–ª–∞–Ω–∏—è: ${receiver.wishlist.join(', ')}\n`;
                    }
                    message += '\n';
                }
                
                alert(message);
            } catch (error) {
                Utils.showNotification('–¢–æ–ª—å–∫–æ –æ—Ä–≥–∞–Ω–∏–∑–∞—Ç–æ—Ä –º–æ–∂–µ—Ç –ø—Ä–æ—Å–º–∞—Ç—Ä–∏–≤–∞—Ç—å –≤—Å–µ –Ω–∞–∑–Ω–∞—á–µ–Ω–∏—è', 'error');
            }
        }
        
        // –î–æ–±–∞–≤–∏–º —Ñ—É–Ω–∫—Ü–∏—é –≤ API –¥–ª—è –ø–æ–ª—É—á–µ–Ω–∏—è –≤—Å–µ—Ö –Ω–∞–∑–Ω–∞—á–µ–Ω–∏–π
        if (!API.getAllAssignments) {
            API.getAllAssignments = async function(groupId) {
                return this.request(`/api/groups/${groupId}/assignments`);
            };
        }
        
        // –ü–æ–∫–∞–∑ –º–æ–¥–∞–ª—å–Ω–æ–≥–æ –æ–∫–Ω–∞ –ø—Ä–∏–≥–ª–∞—à–µ–Ω–∏—è
        function copyInviteLink() {
            const modal = document.getElementById('inviteModal');
            const inviteLink = document.getElementById('inviteLink');
            const inviteCode = document.getElementById('inviteCode');
            
            const link = `${window.location.origin}/join-group.html?code=${currentGroup.code}`;
            
            inviteLink.value = link;
            inviteCode.value = currentGroup.code;
            
            modal.style.display = 'flex';
        }
        
        // –ó–∞–∫—Ä—ã—Ç–∏–µ –º–æ–¥–∞–ª—å–Ω–æ–≥–æ –æ–∫–Ω–∞
        function closeInviteModal() {
            document.getElementById('inviteModal').style.display = 'none';
        }
        
        // –ö–æ–ø–∏—Ä–æ–≤–∞–Ω–∏–µ —Å—Å—ã–ª–∫–∏
        function copyLink() {
            const link = document.getElementById('inviteLink').value;
            Utils.copyToClipboard(link);
        }
        
        // –ö–æ–ø–∏—Ä–æ–≤–∞–Ω–∏–µ –∫–æ–¥–∞
        function copyCode() {
            const code = document.getElementById('inviteCode').value;
            Utils.copyToClipboard(code);
        }
        
        // –ó–∞–∫—Ä—ã—Ç–∏–µ –º–æ–¥–∞–ª—å–Ω–æ–≥–æ –æ–∫–Ω–∞ –ø–æ –∫–ª–∏–∫—É –≤–Ω–µ –µ–≥–æ
        window.onclick = function(event) {
            const modal = document.getElementById('inviteModal');
            if (event.target === modal) {
                closeInviteModal();
            }
        }
        
        // –ó–∞–≥—Ä—É–∂–∞–µ–º –≥—Ä—É–ø–ø—É –ø—Ä–∏ –∑–∞–≥—Ä—É–∑–∫–µ —Å—Ç—Ä–∞–Ω–∏—Ü—ã
        document.addEventListener('DOMContentLoaded', loadGroup);
    </script>
</body>
</html>